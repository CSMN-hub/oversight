<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oversight - Memecoin Intelligence Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .data-source-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .source-mcp { background: #10b981; color: white; }
        .source-claude { background: #8b5cf6; color: white; }
        .source-mock { background: #f59e0b; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <!-- 
    NETLIFY SERVERLESS FUNCTION CODE
    Create file: netlify/functions/crypto-data.js
    
    const fetch = require('node-fetch');

    exports.handler = async (event, context) => {
        const headers = {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Headers': 'Content-Type, Authorization',
            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS'
        };
        
        if (event.httpMethod === 'OPTIONS') {
            return { statusCode: 200, headers, body: '' };
        }
        
        try {
            const { coin } = JSON.parse(event.body || '{}');
            
            if (!coin) {
                return {
                    statusCode: 400,
                    headers,
                    body: JSON.stringify({ error: 'Coin parameter is required' })
                };
            }

            // FALLBACK LAYER 1: Try LunarCrush MCP first
            try {
                const mcpData = await tryLunarCrushMCP(coin);
                if (mcpData) {
                    return {
                        statusCode: 200,
                        headers,
                        body: JSON.stringify({
                            ...mcpData,
                            dataSource: 'LunarCrush MCP',
                            isDemo: false
                        })
                    };
                }
            } catch (mcpError) {
                console.log('MCP failed, trying Claude backup:', mcpError.message);
            }

            // FALLBACK LAYER 2: Claude AI Analysis
            try {
                const claudeData = await analyzeWithClaude(coin);
                if (claudeData) {
                    return {
                        statusCode: 200,
                        headers,
                        body: JSON.stringify({
                            ...claudeData,
                            dataSource: 'Claude AI Analysis',
                            isDemo: false
                        })
                    };
                }
            } catch (claudeError) {
                console.log('Claude failed, using mock data:', claudeError.message);
            }

            // FALLBACK LAYER 3: Mock Data
            const mockData = generateMockData(coin);
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({
                    ...mockData,
                    dataSource: 'Mock Data',
                    isDemo: true
                })
            };
            
        } catch (error) {
            console.error('Function error:', error);
            
            const { coin } = JSON.parse(event.body || '{}');
            const fallbackData = generateMockData(coin || 'BTC');
            
            return {
                statusCode: 200,
                headers,
                body: JSON.stringify({
                    ...fallbackData,
                    dataSource: 'Error Fallback',
                    isDemo: true,
                    error: error.message
                })
            };
        }
    };

    async function tryLunarCrushMCP(coin) {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${process.env.CLAUDE_API_KEY}`,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-3-5-sonnet-20241022',
                max_tokens: 2000,
                tools: [
                    {
                        name: "lunar_topic",
                        description: "Get cryptocurrency data from LunarCrush",
                        input_schema: {
                            type: "object",
                            properties: {
                                topic: {
                                    type: "string",
                                    description: "Cryptocurrency symbol or name"
                                }
                            },
                            required: ["topic"]
                        }
                    }
                ],
                messages: [{
                    role: 'user',
                    content: `Get current data for ${coin} from LunarCrush. Return JSON with: price, sentiment, socialVolume, change24h, marketCap, and topPosts array.`
                }]
            })
        });
        
        if (!response.ok) {
            throw new Error(`MCP API error: ${response.statusText}`);
        }
        
        const data = await response.json();
        // Parse MCP response and return structured data
        return parseMCPResponse(data, coin);
    }

    async function analyzeWithClaude(coin) {
        const prompt = `Analyze the memecoin ${coin} and provide current market intelligence. 

Please provide a JSON response with realistic current data for ${coin}:

1. Estimate current price based on recent market trends
2. Social sentiment score (0-100) based on community activity
3. Social volume estimate 
4. 24h price change estimate
5. Market cap estimate
6. Generate 2 realistic social media posts/news items

Context: ${getCoinContext(coin)}

Return ONLY valid JSON in this exact format:
{
    "coin": "${coin}",
    "price": "0.0000",
    "sentiment": "75.5",
    "socialVolume": 15000,
    "change24h": "-2.34",
    "marketCap": "500000000",
    "topPosts": [
        {
            "title": "Realistic post title about the coin",
            "source": "Twitter/X",
            "time": "3 hours ago",
            "url": "#",
            "engagement": 850,
            "sentiment": "bullish"
        }
    ]
}`;

        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${process.env.CLAUDE_API_KEY}`,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-3-5-sonnet-20241022',
                max_tokens: 1500,
                messages: [{
                    role: 'user',
                    content: prompt
                }]
            })
        });
        
        if (!response.ok) {
            throw new Error(`Claude API error: ${response.statusText}`);
        }
        
        const claudeData = await response.json();
        const content = claudeData.content?.[0]?.text || '';
        
        return parseClaudeResponse(content, coin);
    }

    function parseClaudeResponse(content, coin) {
        let jsonMatch = content.match(/\{[\s\S]*\}/);
        if (!jsonMatch) {
            jsonMatch = content.match(/```json\s*([\s\S]*?)\s*```/) || content.match(/```\s*([\s\S]*?)\s*```/);
            if (jsonMatch) {
                jsonMatch = [jsonMatch[1]];
            }
        }
        
        if (!jsonMatch) {
            throw new Error('No valid JSON found in Claude response');
        }
        
        return JSON.parse(jsonMatch[0]);
    }

    function getCoinContext(coin) {
        const contexts = {
            'SPX6900': 'SPX6900 is a popular memecoin with "cult" following, typically trading around $1.50 range with high community engagement.',
            'DOGE': 'Dogecoin is the original memecoin with strong community, typically trading around $0.20 with massive social volume.',
            'MOG': 'MOG is a newer memecoin with strong TikTok presence, very small price but high engagement.',
            'GIGA': 'GIGA/Gigachad is a meme-based token with moderate community, usually in cents range.',
            'PENGU': 'PENGU is associated with Pudgy Penguins NFT collection, typically trading around $0.03-0.04.',
            'PUMP': 'PUMP is a memecoin focused on pump themes, varies widely in price and sentiment.'
        };
        return contexts[coin] || `${coin} is a cryptocurrency with active community and social presence.`;
    }

    function generateMockData(coin) {
        const mockPrices = {
            'SPX6900': { base: 1.61, volatility: 0.1 },
            'DOGE': { base: 0.199, volatility: 0.05 },
            'MOG': { base: 0.00000118, volatility: 0.15 },
            'GIGA': { base: 0.01592, volatility: 0.12 },
            'PENGU': { base: 0.03404, volatility: 0.08 },
            'PUMP': { base: 0.05, volatility: 0.2 }
        };
        
        const coinData = mockPrices[coin] || { base: 1, volatility: 0.1 };
        const price = coinData.base * (1 + (Math.random() - 0.5) * coinData.volatility);
        const change24h = (Math.random() - 0.5) * 10;
        
        return {
            coin: coin,
            price: price.toFixed(price < 0.01 ? 8 : 4),
            sentiment: (50 + Math.random() * 40).toFixed(1),
            socialVolume: Math.floor(Math.random() * 50000 + 5000),
            change24h: change24h.toFixed(2),
            marketCap: (price * Math.random() * 1000000000).toFixed(0),
            topPosts: [
                {
                    title: `${coin} shows strong momentum in latest market analysis`,
                    source: 'CryptoNews',
                    time: Math.floor(Math.random() * 12 + 1) + ' hours ago',
                    url: '#',
                    engagement: Math.floor(Math.random() * 1000 + 100),
                    sentiment: Math.random() > 0.5 ? 'bullish' : 'bearish'
                }
            ],
            lastUpdated: new Date().toISOString()
        };
    }
    -->

    <!-- Header -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-chart-line text-2xl text-white mr-3"></i>
                    <h1 class="text-xl font-bold text-white">Oversight</h1>
                    <span class="text-sm text-blue-200 ml-3">Memecoin Intelligence</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="refreshAll" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh All
                    </button>
                    <button id="aiChatBtn" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-robot mr-2"></i>Ask Claude
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Coin Tracking Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- SPX6900 -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="spx-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-black text-sm">SPX</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">SPX6900</h3>
                            <p class="text-gray-400 text-sm">SPX</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="spx-source" class="data-source-badge source-mock">MOCK</span>
                        <button onclick="refreshCoin('SPX6900')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="spx-price">$1.61</p>
                        <p class="text-sm" id="spx-change">+8.97%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="spx-sentiment">78.5%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="spx-volume" class="text-white">25,847</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="spx-volume-bar" style="width: 65%"></div>
                    </div>
                </div>
                
                <div id="spx-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            SPX6900 shows strong momentum in latest analysis
                        </a>
                        <p class="text-xs text-gray-500">CryptoNews • 2 hours ago</p>
                    </div>
                </div>
            </div>

            <!-- GIGA -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="giga-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-white text-sm">G</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">GIGA</h3>
                            <p class="text-gray-400 text-sm">GIGA</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="giga-source" class="data-source-badge source-mock">MOCK</span>
                        <button onclick="refreshCoin('GIGA')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="giga-price">$0.01592</p>
                        <p class="text-sm" id="giga-change">+8.82%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="giga-sentiment">72.3%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="giga-volume" class="text-white">18,453</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="giga-volume-bar" style="width: 45%"></div>
                    </div>
                </div>
                
                <div id="giga-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            GIGA community shows strong engagement metrics
                        </a>
                        <p class="text-xs text-gray-500">Reddit • 4 hours ago</p>
                    </div>
                </div>
            </div>

            <!-- MOG -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="mog-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-pink-400 to-red-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-white text-sm">M</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">MOG</h3>
                            <p class="text-gray-400 text-sm">MOG</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="mog-source" class="data-source-badge source-mock">MOCK</span>
                        <button onclick="refreshCoin('MOG')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="mog-price">$0.00000118</p>
                        <p class="text-sm" id="mog-change">+6.28%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="mog-sentiment">84.1%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="mog-volume" class="text-white">32,156</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="mog-volume-bar" style="width: 80%"></div>
                    </div>
                </div>
                
                <div id="mog-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            MOG gains traction on TikTok with viral content
                        </a>
                        <p class="text-xs text-gray-500">TikTok • 1 hour ago</p>
                    </div>
                </div>
            </div>

            <!-- PUMP -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="pump-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-white text-sm">P</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">PUMP</h3>
                            <p class="text-gray-400 text-sm">PUMP</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="pump-source" class="data-source-badge source-mock">MOCK</span>
                        <button onclick="refreshCoin('PUMP')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="pump-price">$0.0542</p>
                        <p class="text-sm" id="pump-change">+12.45%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="pump-sentiment">68.7%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="pump-volume" class="text-white">15,234</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="pump-volume-bar" style="width: 38%"></div>
                    </div>
                </div>
                
                <div id="pump-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            PUMP token sees increased trading activity
                        </a>
                        <p class="text-xs text-gray-500">Twitter • 3 hours ago</p>
                    </div>
                </div>
            </div>

            <!-- DOGE -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="doge-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-black text-sm">D</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">DOGE</h3>
                            <p class="text-gray-400 text-sm">DOGE</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="doge-source" class="data-source-badge source-mock">MOCK</span>
                        <button onclick="refreshCoin('DOGE')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="doge-price">$0.199</p>
                        <p class="text-sm" id="doge-change">+0.60%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="doge-sentiment">76.2%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="doge-volume" class="text-white">89,234</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="doge-volume-bar" style="width: 95%"></div>
                    </div>
                </div>
                
                <div id="doge-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            Dogecoin maintains steady performance amid market volatility
                        </a>
                        <p class="text-xs text-gray-500">CoinDesk • 2 hours ago</p>
                    </div>
                </div>
            </div>

            <!-- PENGU -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="pengu-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-white text-sm">P</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">PENGU</h3>
                            <p class="text-gray-400 text-sm">PENGU</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="pengu-source" class="data-source-badge source-mock">MOCK</span>
                        <button onclick="refreshCoin('PENGU')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="pengu-price">$0.03404</p>
                        <p class="text-sm" id="pengu-change">+4.20%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="pengu-sentiment">81.3%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="pengu-volume" class="text-white">42,567</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="pengu-volume-bar" style="width: 85%"></div>
                    </div>
                </div>
                
                <div id="pengu-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            PENGU benefits from Pudgy Penguins NFT collection success
                        </a>
                        <p class="text-xs text-gray-500">NFT News • 5 hours ago</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4">Sentiment Comparison</h3>
            <div style="height: 400px;">
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="aiChatModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Ask Claude About Crypto</h3>
                    <button onclick="closeAIChat()" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="chatMessages" class="bg-gray-900 rounded-lg p-4 h-64 overflow-y-auto mb-4">
                    <p class="text-gray-400">Hi! I can analyze crypto sentiment and provide market intelligence. Try asking:</p>
                    <ul class="text-sm text-blue-400 mt-2">
                        <li>• "What's driving SPX6900 sentiment?"</li>
                        <li>• "Compare MOG vs GIGA social volume"</li>
                        <li>• "Which coin has the most buzz today?"</li>
                    </ul>
                </div>
                
                <div class="flex">
                    <input type="text" id="chatInput" placeholder="Ask about crypto sentiment..." 
                           class="flex-1 bg-gray-700 text-white px-4 py-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="sendChatMessage()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-r-lg transition-colors">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-gray-800 rounded-lg p-8 text-center">
            <div class="loading-spinner"></div>
            <p class="text-white">Fetching crypto intelligence...</p>
            <p class="text-gray-400 text-sm mt-2">Trying LunarCrush MCP → Claude Analysis → Fallback</p>
        </div>
    </div>

    <script>
        // Configuration
        const COINS = ['SPX6900', 'GIGA', 'MOG', 'PUMP', 'DOGE', 'PENGU'];
        let sentimentChart = null;

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            
            // Set up event listeners
            document.getElementById('refreshAll').addEventListener('click', refreshAllCoins);
            document.getElementById('aiChatBtn').addEventListener('click', openAIChat);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendChatMessage();
            });
        });

        // Initialize Chart
        function initializeChart() {
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            sentimentChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: COINS,
                    datasets: [{
                        label: 'Sentiment Score',
                        data: [78.5, 72.3, 84.1, 68.7, 76.2, 81.3],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(59, 130, 246)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: 'white' },
                            ticks: { 
                                color: 'white',
                                backdropColor: 'transparent'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        // Refresh single coin data
        async function refreshCoin(coin) {
            showLoadingState(coin);
            
            try {
                const response = await fetch('/.netlify/functions/crypto-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ coin: coin })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                updateCoinDisplay(coin, data);
                updateChart();
                
            } catch (error) {
                console.error(`Error fetching data for ${coin}:`, error);
                showErrorState(coin);
            }
        }

        // Update coin display with new data
        function updateCoinDisplay(coin, data) {
            const prefix = coin.toLowerCase();
            
            // Update data source badge
            const sourceElement = document.getElementById(`${prefix}-source`);
            if (sourceElement) {
                sourceElement.textContent = getSourceLabel(data.dataSource);
                sourceElement.className = 'data-source-badge ' + getSourceClass(data.dataSource);
            }
            
            // Update price
            document.getElementById(`${prefix}-price`).textContent = `$${data.price}`;
            
            // Update change with color
            const changeElement = document.getElementById(`${prefix}-change`);
            const change = parseFloat(data.change24h);
            changeElement.textContent = `${change >= 0 ? '+' : ''}${change}%`;
            changeElement.className = change >= 0 ? 'text-sm text-green-400' : 'text-sm text-red-400';
            
            // Update sentiment
            document.getElementById(`${prefix}-sentiment`).textContent = `${data.sentiment}%`;
            
            // Update social volume
            document.getElementById(`${prefix}-volume`).textContent = data.socialVolume.toLocaleString();
            const volumeBar = document.getElementById(`${prefix}-volume-bar`);
            const volumePercent = Math.min((data.socialVolume / 100000) * 100, 100);
            volumeBar.style.width = `${volumePercent}%`;
            
            // Update news
            const newsContainer = document.getElementById(`${prefix}-news`);
            if (data.topPosts && data.topPosts.length > 0) {
                newsContainer.innerHTML = data.topPosts.map(post => `
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="${post.url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm">
                            ${post.title}
                        </a>
                        <p class="text-xs text-gray-500">${post.source} • ${post.time}</p>
                    </div>
                `).join('');
            }
        }

        function getSourceLabel(dataSource) {
            if (dataSource.includes('MCP')) return 'MCP';
            if (dataSource.includes('Claude')) return 'CLAUDE';
            return 'MOCK';
        }

        function getSourceClass(dataSource) {
            if (dataSource.includes('MCP')) return 'source-mcp';
            if (dataSource.includes('Claude')) return 'source-claude';
            return 'source-mock';
        }

        // Show loading state
        function showLoadingState(coin) {
            const prefix = coin.toLowerCase();
            document.getElementById(`${prefix}-price`).innerHTML = '<div class="loading-spinner"></div>Updating...';
            document.getElementById(`${prefix}-sentiment`).innerHTML = '<div class="loading-spinner"></div>Analyzing...';
        }

        // Show error state
        function showErrorState(coin) {
            const prefix = coin.toLowerCase();
            document.getElementById(`${prefix}-price`).textContent = 'Error';
            document.getElementById(`${prefix}-sentiment`).textContent = 'Error';
            document.getElementById(`${prefix}-volume`).textContent = 'Error';
        }

        // Refresh all coins
        async function refreshAllCoins() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            const promises = COINS.map(coin => refreshCoin(coin));
            await Promise.all(promises);
            
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Update radar chart
        function updateChart() {
            const sentimentData = COINS.map(coin => {
                const prefix = coin.toLowerCase();
                const sentimentText = document.getElementById(`${prefix}-sentiment`).textContent;
                return sentimentText !== 'Error' && !sentimentText.includes('div') ? 
                       parseFloat(sentimentText.replace('%', '')) : 0;
            });
            
            sentimentChart.data.datasets[0].data = sentimentData;
            sentimentChart.update();
        }

        // AI Chat Functions
        function openAIChat() {
            document.getElementById('aiChatModal').classList.remove('hidden');
        }

        function closeAIChat() {
            document.getElementById('aiChatModal').classList.add('hidden');
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatMessages = document.getElementById('chatMessages');
            
            // Add user message
            chatMessages.innerHTML += `
                <div class="mb-3">
                    <div class="text-blue-400 text-sm font-semibold">You:</div>
                    <div class="text-white">${message}</div>
                </div>
            `;
            
            input.value = '';
            
            // Add loading response
            chatMessages.innerHTML += `
                <div class="mb-3" id="aiResponse">
                    <div class="text-purple-400 text-sm font-semibold">Claude:</div>
                    <div class="text-gray-300"><div class="loading-spinner"></div>Analyzing crypto intelligence...</div>
                </div>
            `;
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            try {
                // Simulate AI response based on current dashboard data
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const aiResponse = generateAIResponse(message);
                
                document.getElementById('aiResponse').innerHTML = `
                    <div class="text-purple-400 text-sm font-semibold">Claude:</div>
                    <div class="text-white">${aiResponse}</div>
                `;
                
            } catch (error) {
                document.getElementById('aiResponse').innerHTML = `
                    <div class="text-purple-400 text-sm font-semibold">Claude:</div>
                    <div class="text-red-400">I'm having trouble accessing the latest data. Please try refreshing the dashboard first.</div>
                `;
            }
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('spx') || lowerMessage.includes('spx6900')) {
                return "SPX6900 is showing strong momentum with 78.5% positive sentiment and high social volume of 25,847 mentions. The cult-like community continues to drive engagement, with recent posts highlighting technical analysis and community events.";
            }
            
            if (lowerMessage.includes('mog')) {
                return "MOG has the highest sentiment score at 84.1% with impressive social volume of 32,156 mentions. The token is gaining significant traction on TikTok with viral content, showing strong community engagement and meme potential.";
            }
            
            if (lowerMessage.includes('doge')) {
                return "DOGE maintains its position as the leader in social volume with 89,234 mentions and 76.2% sentiment. Despite modest price movement (+0.60%), the community remains highly active and engaged across all social platforms.";
            }
            
            if (lowerMessage.includes('compare') || lowerMessage.includes('vs')) {
                return "Based on current data: MOG leads in sentiment (84.1%), DOGE dominates social volume (89K mentions), and SPX6900 shows strong price momentum (+8.97%). Each coin serves different niches in the memecoin ecosystem.";
            }
            
            if (lowerMessage.includes('which') && lowerMessage.includes('best')) {
                return "It depends on your criteria: MOG has the highest sentiment and TikTok viral potential, DOGE offers stability and massive community, while SPX6900 shows the strongest recent price action. Consider your risk tolerance and investment timeline.";
            }
            
            return "I can analyze any of the tracked coins (SPX6900, GIGA, MOG, PUMP, DOGE, PENGU) based on current sentiment, social volume, and price data. What specific aspect would you like me to focus on?";
        }

        // Auto-refresh every 10 minutes
        setInterval(refreshAllCoins, 10 * 60 * 1000);
    </script>
</body>
</html>
