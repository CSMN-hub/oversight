<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oversight - Memecoin Intelligence Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .data-source-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .source-claude { background: #8b5cf6; color: white; }
        .source-demo { background: #f59e0b; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-chart-line text-2xl text-white mr-3"></i>
                    <h1 class="text-xl font-bold text-white">Oversight</h1>
                    <span class="text-sm text-blue-200 ml-3">Memecoin Intelligence</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="refreshAll" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh All
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Status Bar -->
    <div id="statusBar" class="bg-gray-800 px-4 py-2 text-center">
        <span id="statusText" class="text-sm text-gray-400">Dashboard ready • Click refresh to load live data</span>
        <span id="lastUpdate" class="text-xs text-gray-500 ml-4"></span>
    </div>

    <!-- Main Dashboard -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Coin Tracking Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- SPX6900 -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="spx-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-black text-sm">SPX</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">SPX6900</h3>
                            <p class="text-gray-400 text-sm">SPX</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="spx-source" class="data-source-badge source-demo">DEMO</span>
                        <button onclick="refreshCoin('SPX6900')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="spx-price">$1.61</p>
                        <p class="text-sm text-green-400" id="spx-change">+8.97%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="spx-sentiment">78.5%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="spx-volume" class="text-white">25,847</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="spx-volume-bar" style="width: 65%"></div>
                    </div>
                </div>
                
                <div id="spx-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            SPX6900 shows strong momentum in latest analysis
                        </a>
                        <p class="text-xs text-gray-500">Demo Data • 2 hours ago</p>
                    </div>
                </div>
            </div>

            <!-- DOGE -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="doge-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-black text-sm">D</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">DOGE</h3>
                            <p class="text-gray-400 text-sm">DOGE</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="doge-source" class="data-source-badge source-demo">DEMO</span>
                        <button onclick="refreshCoin('DOGE')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="doge-price">$0.199</p>
                        <p class="text-sm text-green-400" id="doge-change">+0.60%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="doge-sentiment">76.2%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="doge-volume" class="text-white">89,234</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="doge-volume-bar" style="width: 95%"></div>
                    </div>
                </div>
                
                <div id="doge-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            Dogecoin maintains steady performance amid market volatility
                        </a>
                        <p class="text-xs text-gray-500">Demo Data • 2 hours ago</p>
                    </div>
                </div>
            </div>

            <!-- MOG -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="mog-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-pink-400 to-red-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-white text-sm">M</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">MOG</h3>
                            <p class="text-gray-400 text-sm">MOG</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="mog-source" class="data-source-badge source-demo">DEMO</span>
                        <button onclick="refreshCoin('MOG')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="mog-price">$0.00000118</p>
                        <p class="text-sm text-green-400" id="mog-change">+6.28%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="mog-sentiment">84.1%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="mog-volume" class="text-white">32,156</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="mog-volume-bar" style="width: 80%"></div>
                    </div>
                </div>
                
                <div id="mog-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            MOG gains traction on TikTok with viral content
                        </a>
                        <p class="text-xs text-gray-500">Demo Data • 1 hour ago</p>
                    </div>
                </div>
            </div>

            <!-- PENGU -->
            <div class="bg-gray-800 rounded-lg p-6 card-hover" id="pengu-card">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full flex items-center justify-center mr-3">
                            <span class="font-bold text-white text-sm">P</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">PENGU</h3>
                            <p class="text-gray-400 text-sm">PENGU</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span id="pengu-source" class="data-source-badge source-demo">DEMO</span>
                        <button onclick="refreshCoin('PENGU')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-xs">Price</p>
                        <p class="text-xl font-bold text-green-400" id="pengu-price">$0.03404</p>
                        <p class="text-sm text-green-400" id="pengu-change">+4.20%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs">Sentiment</p>
                        <p class="text-xl font-bold text-blue-400" id="pengu-sentiment">81.3%</p>
                        <p class="text-sm text-gray-400">Social Score</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <p class="text-gray-400 text-xs mb-2">Social Volume: <span id="pengu-volume" class="text-white">42,567</span></p>
                    <div class="bg-gray-700 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full transition-all duration-500" id="pengu-volume-bar" style="width: 85%"></div>
                    </div>
                </div>
                
                <div id="pengu-news" class="space-y-2">
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">
                            PENGU benefits from Pudgy Penguins NFT collection success
                        </a>
                        <p class="text-xs text-gray-500">Demo Data • 5 hours ago</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4">Sentiment Comparison</h3>
            <div style="height: 400px;">
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-40">
        <div class="bg-gray-800 rounded-lg p-8 text-center">
            <div class="loading-spinner"></div>
            <p class="text-white">Fetching crypto intelligence...</p>
        </div>
    </div>

    <script>
        const COINS = ['SPX6900', 'DOGE', 'MOG', 'PENGU'];
        let sentimentChart = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            document.getElementById('refreshAll').addEventListener('click', refreshAllCoins);
        });

        function initializeChart() {
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            sentimentChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: COINS,
                    datasets: [{
                        label: 'Sentiment Score',
                        data: [78.5, 76.2, 84.1, 81.3],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(59, 130, 246)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    },
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: 'white' },
                            ticks: { color: 'white', backdropColor: 'transparent' },
                            min: 0, max: 100
                        }
                    }
                }
            });
        }

        function updateStatus(message, isError = false) {
            const statusText = document.getElementById('statusText');
            const lastUpdate = document.getElementById('lastUpdate');
            statusText.textContent = message;
            statusText.className = isError ? 'text-sm text-red-400' : 'text-sm text-green-400';
            lastUpdate.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        async function refreshCoin(coin) {
            showLoadingState(coin);
            try {
                updateStatus(`Fetching ${coin} data...`);
                const response = await fetch('/.netlify/functions/crypto-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ coin: coin })
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                updateCoinDisplay(coin, data);
                updateChart();
                updateStatus(`${coin} updated successfully`);
                
            } catch (error) {
                console.error(`Error fetching ${coin}:`, error);
                showErrorState(coin);
                updateStatus(`Error updating ${coin}`, true);
            }
        }

        function updateCoinDisplay(coin, data) {
            const prefix = coin.toLowerCase();
            
            // Update source badge
            const sourceElement = document.getElementById(`${prefix}-source`);
            if (sourceElement) {
                sourceElement.textContent = data.dataSource?.includes('Claude') ? 'CLAUDE' : 'DEMO';
                sourceElement.className = 'data-source-badge ' + (data.dataSource?.includes('Claude') ? 'source-claude' : 'source-demo');
            }
            
            // Update price
            const priceElement = document.getElementById(`${prefix}-price`);
            if (priceElement) priceElement.textContent = `$${data.price}`;
            
            // Update change with color
            const changeElement = document.getElementById(`${prefix}-change`);
            if (changeElement) {
                const change = parseFloat(data.change24h);
                changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeElement.className = change >= 0 ? 'text-sm text-green-400' : 'text-sm text-red-400';
            }
            
            // Update sentiment
            const sentimentElement = document.getElementById(`${prefix}-sentiment`);
            if (sentimentElement) sentimentElement.textContent = `${parseFloat(data.sentiment).toFixed(1)}%`;
            
            // Update volume
            const volumeElement = document.getElementById(`${prefix}-volume`);
            if (volumeElement) volumeElement.textContent = parseInt(data.socialVolume).toLocaleString();
            
            const volumeBar = document.getElementById(`${prefix}-volume-bar`);
            if (volumeBar) {
                const volumePercent = Math.min((parseInt(data.socialVolume) / 100000) * 100, 100);
                volumeBar.style.width = `${volumePercent}%`;
            }
            
            // Update news
            const newsContainer = document.getElementById(`${prefix}-news`);
            if (newsContainer && data.topPosts && data.topPosts.length > 0) {
                newsContainer.innerHTML = data.topPosts.map(post => `
                    <div class="border-l-2 border-blue-500 pl-3 py-1">
                        <a href="#" class="text-blue-400 hover:text-blue-300 text-sm">${post.title}</a>
                        <p class="text-xs text-gray-500">${post.source} • ${post.time}</p>
                    </div>
                `).join('');
            }
        }

        function showLoadingState(coin) {
            const prefix = coin.toLowerCase();
            const priceElement = document.getElementById(`${prefix}-price`);
            const sentimentElement = document.getElementById(`${prefix}-sentiment`);
            
            if (priceElement) priceElement.innerHTML = '<div class="loading-spinner"></div>Loading...';
            if (sentimentElement) sentimentElement.innerHTML = '<div class="loading-spinner"></div>Loading...';
        }

        function showErrorState(coin) {
            const prefix = coin.toLowerCase();
            const priceElement = document.getElementById(`${prefix}-price`);
            const sentimentElement = document.getElementById(`${prefix}-sentiment`);
            
            if (priceElement) priceElement.innerHTML = '<span class="text-red-400">Error</span>';
            if (sentimentElement) sentimentElement.innerHTML = '<span class="text-red-400">Error</span>';
        }

        async function refreshAllCoins() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            updateStatus('Refreshing all coins...');
            
            try {
                const promises = COINS.map(async (coin, index) => {
                    await new Promise(resolve => setTimeout(resolve, index * 500));
                    return refreshCoin(coin);
                });
                
                await Promise.all(promises);
                updateStatus('All coins refreshed successfully');
                
            } catch (error) {
                updateStatus('Some coins failed to refresh', true);
            } finally {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }
        }

        function updateChart() {
            const sentimentData = COINS.map(coin => {
                const prefix = coin.toLowerCase();
                const sentimentElement = document.getElementById(`${prefix}-sentiment`);
                if (!sentimentElement) return 0;
                
                const sentimentText = sentimentElement.textContent;
                if (sentimentText.includes('Error') || sentimentText.includes('Loading')) return 0;
                
                return parseFloat(sentimentText.replace('%', '')) || 0;
            });
            
            if (sentimentChart) {
                sentimentChart.data.datasets[0].data = sentimentData;
                sentimentChart.update('none');
            }
        }
    </script>
</body>
</html>
